<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Polishändelser – TV Rullning</title>

<style>
:root {
    --blue-main: #0b4edb;
    --blue-soft: #eef4ff;
    --white: #ffffff;
    --text: #ffffff;
}

body, html {
    margin: 0;
    padding: 0;
    background: var(--blue-main);
    color: var(--text);
    font-family: system-ui, -apple-system, sans-serif;
    height: 100vh;
    overflow: hidden;
}

/* Container för rullande lista */
#tv-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    padding: 20px;
    box-sizing: border-box;
}

/* Lista */
#event-list {
    position: absolute;
    width: 100%;
}

/* Varje rad */
.event {
    padding: 10px 20px;
    border-bottom: 1px solid var(--blue-soft);
    font-size: 2em;
    line-height: 1.4;
    background: var(--blue-main);
}

/* För animation */
@keyframes scrollUp {
    0% { transform: translateY(100%); }
    100% { transform: translateY(-100%); }
}
</style>
</head>
<body>

<div id="tv-container">
    <div id="event-list"></div>
</div>

<audio id="newSound" src="https://www.soundjay.com/button/beep-07.wav" preload="auto"></audio>

<script>
const eventList = document.getElementById("event-list");
const sound = document.getElementById("newSound");
let events = [];

// Hämta polishändelser
async function loadEvents() {
    const res = await fetch("https://polisen.se/api/events");
    const data = await res.json();

    events = data.slice(0, 20); // max 20 händelser

    // Bygg listan
    events.forEach(event => {
        const div = document.createElement("div");
        div.className = "event";
        div.innerHTML = `
            <strong>${event.type}</strong> - ${event.location.name} - ${event.datetime}<br>
            ${event.summary}
        `;
        eventList.appendChild(div);
    });

    startScrolling();
}

// Scroll-funktion
function startScrolling() {
    const totalHeight = eventList.scrollHeight;
    let pos = 0;

    function step() {
        pos -= 1; // scroll speed
        if (pos <= -totalHeight) pos = eventList.parentElement.clientHeight;

        eventList.style.transform = `translateY(${pos}px)`;

        // Om en ny händelse når toppen (ungefär) spela ljud
        eventList.childNodes.forEach((child, index) => {
            const rect = child.getBoundingClientRect();
            if(rect.top <= 40 && rect.top > 0) {
                sound.currentTime = 0;
                sound.play();
            }
        });

        requestAnimationFrame(step);
    }

    step();
}

loadEvents();
</script>

</body>
</html>