<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Polish√§ndelser ‚Äì Modern Bl√• Tabell</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
:root {
    --blue-main: #0b4edb;       /* huvudbl√• */
    --blue-soft: #eef4ff;       /* ljus bl√• */
    --blue-hover: #c7dbff;      /* hover */
    --blue-border: #c7d7ff;
    --white: #ffffff;
    --text: #0f172a;
}

body {
    margin: 0;
    font-family: "Inter", system-ui, -apple-system, sans-serif;
    background: var(--white);
    color: var(--text);
}

/* Header */
header {
    background: var(--blue-main);
    color: white;
    padding: 16px 20px;
    font-size: 1.4em;
    font-weight: 700;
    letter-spacing: 0.5px;
}

/* Karta */
#map {
    display: none; /* visas f√∂rst n√§r man klickar p√• en rad */
    height: 45vh;
    width: 100%;
    border-bottom: 3px solid var(--blue-border);
}

/* Tabell */
.table-wrapper {
    padding: 20px;
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 0.95em;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

thead th {
    background: var(--blue-soft);
    color: var(--blue-main);
    padding: 12px 16px;
    border-bottom: 2px solid var(--blue-border);
    text-align: left;
    position: sticky;
    top: 0;
}

tbody td {
    padding: 14px 16px;
    border-bottom: 1px solid var(--blue-border);
}

tbody tr {
    transition: background 0.25s;
}

tbody tr:hover {
    background: var(--blue-hover);
    cursor: pointer;
}

.type {
    font-weight: 600;
    color: var(--blue-main);
}

.place {
    font-weight: 500;
    text-decoration: underline;
    color: var(--blue-main);
}

.summary {
    color: var(--text);
}

/* Scrollbar f√∂r moderna webbl√§sare */
.table-wrapper::-webkit-scrollbar {
    height: 8px;
}

.table-wrapper::-webkit-scrollbar-thumb {
    background: var(--blue-main);
    border-radius: 4px;
}

.table-wrapper::-webkit-scrollbar-track {
    background: var(--blue-soft);
}
</style>
</head>

<body>

<header>üöì Polish√§ndelser ‚Äì Modern Bl√• Tabell</header>

<div id="map"></div>

<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>Typ</th>
                <th>Plats</th>
                <th>Tid</th>
                <th>Sammanfattning</th>
            </tr>
        </thead>
        <tbody id="eventTable"></tbody>
    </table>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map;
let mapReady = false;
let activeMarker;

async function loadEvents() {
    const table = document.getElementById("eventTable");
    const res = await fetch("https://polisen.se/api/events");
    const data = await res.json();

    data.forEach(event => {
        if (!event.location?.gps) return;

        const [lat, lon] = event.location.gps.split(",");

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td class="type">${event.type}</td>
            <td class="place">${event.location.name}</td>
            <td>${event.datetime}</td>
            <td class="summary">${event.summary}</td>
        `;

        tr.onclick = () => showMap(lat, lon, event);
        table.appendChild(tr);
    });
}

function showMap(lat, lon, event) {
    const mapDiv = document.getElementById("map");
    mapDiv.style.display = "block";

    if (!mapReady) {
        map = L.map("map").setView([lat, lon], 14);

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 18,
            attribution: "¬© OpenStreetMap"
        }).addTo(map);

        mapReady = true;
    } else {
        map.setView([lat, lon], 14, { animate: true });
        if (activeMarker) map.removeLayer(activeMarker);
    }

    activeMarker = L.marker([lat, lon])
        .addTo(map)
        .bindPopup(`
            <strong>${event.type}</strong><br>
            üìç ${event.location.name}<br>
            üïí ${event.datetime}<br>
            ${event.summary}
        `)
        .openPopup();

    map.invalidateSize();
}

loadEvents();
</script>

</body>
</html>